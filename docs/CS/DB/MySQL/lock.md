## Introduction



InnoDB 事务执行过程中，加表锁或者行锁之后，释放锁最常见的时机是事务提交或者回滚即将完成时。

因为事务的生命周期结束，它加的锁的生命周期也随之结束。

有一种情况，加锁只是权宜之计，临时为之。如果这种锁也要等到事务提交或者回滚即将完成时才释放，阻塞其它事务的时间也可能更长，这就有点不合理了。所以，这种锁会在事务运行过程中及时释放。

还有一种情况，虽然是在事务提交过程中释放锁，但是并不会等到提交即将完成时才释放，而是在二阶段提交的 prepare 阶段就提前释放。

最后，有点特殊的就是 AUTO-INC 锁了




我们先来看看只是权宜之计的加锁场景。

select、update、delete 语句执行过程中，不管 where 条件是否命中索引，也不管是等值查询还是范围查询，只要扫描过的记录，都会加行锁。

> 和 update、delete 不一样，select 只在需要加锁时，才会按照上面的逻辑加锁。




## Links




## References






