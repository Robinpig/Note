## Introduction

拓扑排序（Topological sorting）要解决的问题是如何给一个有向无环图的所有节点排序
拓扑排序的目标是将所有节点排序，使得排在前面的节点不能依赖于排在后面的节点

## AOV 网

一个 AOV 网(*Activity On Vertex NetWork*) 必定是一个有向无环图，即不带有回路 与 DAG 不同的是，AOV 的活动都表示在顶点上，边表示活动（顶点）发生的先后关系

若网中所有活动均可以排出先后顺序（任两个活动之间均确定先后顺序），则称网是拓扑有序的

**算法步骤**

- 在网络中选择一个入度为0的顶点输出；
- 在图中删除该顶点及所有以该顶点为起点的边；
- 重复上述过程，直至所有边均被输出, 或者图中不存在入度为零的点，此时说明图是有环图，拓扑排序无法完成，陷入死锁



使用邻接表存储，为了方便找没有前驱的结点，每个顶点加上它的入度信息。删去从该顶点出发的弧，就相当于把该顶点邻接的顶点的入度都减一。同时为了避免删去同一个顶点，设立辅助栈专门存放没有前驱的顶点

- 查找邻接表中入度为0的顶点，入栈
- 栈非空，进行拓扑排序
- 栈顶顶点出栈并输出
- 查找出栈顶点的所有后继顶点，将其入度减一，并把此时入度为0的点入栈
- 栈空时，输出全部顶点则拓扑排序完成，否则说明有环







## AOE 网

AOE 网(*Activity On Edge Network*) 的定义：在带权有向图中若以顶点表示事件，有向边表示活动，边上的权值表示该活动持续的时间，这样的图简称为AOE网

AOE 网应该是无环的，且存在唯一入度为零的起始顶点（源点），以及唯一出度为零的完成顶点（汇点）

AOV网的活动以顶点表示，而AOE网的活动以有向边来表示，AOV网的有向边仅仅表示活动的先后次序

AOE 网的相关基本概念

- 事件（顶点）$v_i$ 的最早发生时间：该事件最早可能的发生时间，记为 $ve(i)$ ，它决定了以该顶点开始的活动的最早发生时间，显然源点的的最早发生时间为 0。
  因为事件发生需要其所有前驱活动全部完成，所以它等于初始点到该顶点的路径长度的最大值，写成递推：$ve(i) = \max\{ve(j) + val^j_i ~\vert~ j \in pre_i\}$ ，
  其中 $val^j_i$ 表示 j 到 i 的边的权值（即 j 到 i 的活动的持续时间），$pre_i$ 表示 i 的所有前驱事件的集合
- 事件（顶点）$v_i$ 的最迟发生时间：在不推迟整个工期的前提下，该事件最晚能容忍的发生时间，记为 $vl(i)$ ，它决定了所有以该状态结束的活动的最迟发生时间，
  它等于事件的所有后继活动的最迟开始时间的最小值，即 $vl(i) = \min\{vl(j) - val^i_j ~\vert~ j \in nxt_i\}$ ，
  其中 $val^i_j$ 表示 i 到 j 的边的权值（即 i 到 j 的活动的持续时间），$nxt_i$ 表示 i 的所有后驱事件的集合。
- 活动 $(u, v)$ 的最早开始时间：该活动最早可能的发生时间，记为 $e(u,v)$ ，显然，它等于其前驱事件的最早发生时间，即 $e(u,v)=ve(u)$ 
- 活动 $(u, v)$ 的最迟开始时间：在不推迟整个工期的前提下，活动开始最晚能容忍的时间，记为 $l(u,v)$ ，它等于其后继事件的最迟发生时间 - 该事件的持续时间（权值），即 $l(u,v)=vl(v)-val^u_v$ ，\
  其中 $val^u_v$ 表示 u 到 v 的边的权值（即 u 到 v 的活动的持续时间）
- 关键路径：AOE 网中从源点到汇点的最长路径的长度
- 关键活动：即关键路径上的活动，它的最早开始时间和最迟开始时间相等



## 关键路径
AOE 网中的有些活动是可以并行进行的，所以完成整个工程的最短时间是从开始点到完成点的最长活动路径长度
因为一项工程需要完成所有工程内的活动, 所以**最长的活动路径**也是**关键路径**，它决定工程完成的总时间



## 应用

拓扑排序可以判断图中是否有环，还可以用来判断图是否是一条链。拓扑排序可以用来求 AOE 网中的关键路径，估算工程完成的最短时间






## Links

- [graph](/docs/CS/Algorithms/graph/graph.md)