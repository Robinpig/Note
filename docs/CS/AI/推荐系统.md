



个性化开发平台（The Personalization Platform，简称TPP)，面向算法和工程同学，支持召回、在线预测等业务编排的开发平台，专注于推荐、搜索、广告行业。提供成熟的工程框架，帮助算法从资源管理、运维中解放出来，专注业务逻辑开发、业务效果实验



TPP的主要用户是搜推广业务的算法同学，以推荐你喜欢的商品为例，来看服务的上线过程：算法同学训练好模型并部署到在线召回引擎、打分引擎，把用户和商品特征数据导入到特征存储，然后就需要让这套数据和模型在线对外提供服务。此时算法同学可以在TPP上创建这个业务场景，并用Java编写业务逻辑。常见的猜你喜欢推荐逻辑是：构建特征（调特征数据库） -> 召回商品（调召回引擎） -> 商品打分（调打分引擎） -> 商品排序 -> 补充商品详情（调详情数据库） -> 输出结果，**可见TPP上的业务逻辑像胶水一样把各类引擎的数据和模型预测结果粘合起来，经过业务加工产出推荐结果。**算法同学基于TPP图化框架实现引擎调用、数据加工，完成业务逻辑开发，在TPP平台上编译并调试，调试无误后发布上线，这时上游系统就可以调用这套推荐服务了。TPP平台在背后完成了容器的部署和拉起、服务的热部署、随着流量波动做机器资源的弹性扩缩。除了基础的在线服务能力外，算法同学可以对流量做分配、打标以完成不同配置的实验；可以利用TPP提供的监控报警、问题排查产品解决线上问题；可以利用TPP提供的分层降级、集群限流、流量兜底等能力保证服务稳定运行



在线服务的请求由用户动作触发，在线服务链路总响应时间一般在几百毫秒，留给链路中一个环节的时间一般不超过300毫秒，然而个性化算法链路有着大量数据读取、数据加工过程，是重CPU和重IO类型的服务。同时在线服务的性能与个性化算法效果相互制约，这体现在个性化算法效果越好就对数据的丰富度、模型复杂度要求越高，从而提高服务响应时长造成超时率增加，超时后的请求一般使用效果平平的兜底数据，从而制约总体算法效果。为此，TPP平台围绕算法在线服务的性能做了多方面工作，其中如何加速业务逻辑执行和业务数据加工是重要的一方面。



在构建特征 -> 召回商品 -> 商品打分 -> 商品排序 -> 补充商品详情 -> 输出结果流程中，需要调多次特征数据库，因为需要丰富的用户和商品特征，需要调多次召回引擎，因为需要多种类型的召回来源，显然，并发的去请求这些数据能显著缩短总处理耗时，然而算法同学并不专长于写并发代码，容易写出BUG或写的性能不高。另一方面，召回后的商品信息是以itemId为主键的多行多列数据，在送往打分、排序等后续流程中，需要根据业务需求做多次加工，例如数据合并、算分、排序、截断、去重等等，这些加工操作代码复杂，容易出错，且会产生大量内存碎片影响性能。基于上述并发需求和数据加工需求，我们推出了TPP图化框架和TPP DataFrame高性能数据集，目标是在提供极致开发体验的前提下，提供极致的性能。



TPP图化框架从19年开始研发，最初定位于利用可执行图结构解决并发性能问题，在图框架内提供数据集操作算子以优化数据加工性能，同时框架抽象层次得以提高从而获得更多优化空间。用户可以用stream api风格的接口构建业务执行图，这是一张数据流图，每个节点是一段业务逻辑，数据从上游节点流转到下游节点，在每个节点被加工处理，相互没有依赖的节点就可以并发执行。图引擎是一个全异步响应式执行引擎，同时对AI·OS引擎的接口均做了异步化改造，从而实现全异步、无阻塞、高并发的业务执行过程。当时改造为图化的业务普遍得到了20%~30%的性能提升。



在图化的推广中我们发现，数据流加工思路与用户熟悉的Java面向对象思路差异较大，学习成本高、调试困难、配套产品不完善，许多同学望而生退。为此TPP图化一方面推出依赖声明式构图、面向对象风格开发方式来降低学习成本，另一方面利用图可编排，有结构化信息的特点，推出了子图组件+在线编排开发方式和图执行过程可视化产品，同时跟一线的算法工程团队合作产出以TPP图化为基础的业务框架和产品，这些业务框架和产品更贴近自己的业务，同时也能利用图化的性能优势和图化公共产品。经过近三年的发展，TPP图化收获了诸多不同业务类型的用户，其中阿里云Saas智能推荐产品Airec就是基于TPP图化框架，Airec有效利用了图编排能力和性能优势帮助用户快速搭建高性能推荐服务。在阿里内部，TPP图化已经被几十个BU所使用，TPP图化日常承载了百万级的QPS，帮助业务普遍提升了30%的性能。

 

**在当前的时间点上，TPP图化仍聚焦在优化性能和提升开发体验上，希望最终能把TPP图化打造成算法在线服务领域易用、性能极致、迭代效率远超普通方式的产品**





## References

1. [打造算法在线服务领域极致开发体验与性能 — 阿里TPP图化框架技术实践-阿里云开发者社区](https://developer.aliyun.com/article/933235)

