




## Keep alive

Android进程和Service的保活，是困扰Android开发人员的一大顽疾。
因涉及到省电和内存管理策略，各厂商基于自家的理解，在自已ROOM发布于都对标准Android发行版作为或多或少的改动，
使得应用层程序在处理进程和Service保活问题上变的异常复杂，且很难兼容，因为说不定哪款手机或者哪个版本的省电策略发生改变，
那么随之而来的就是进程和Service保活的差异。

在应用场景上，由于即时通讯应用（包括IM聊天应用、消息推送服务等）为了保证消息的全时、实时送达能力，必须要实现进程或Service的保活。
而就这一看似不起眼的问题，实际处理起来，因为众多Android手机和Android系统版本的差异，让问题的处理充满了不确定性

以小米手机为例，MIUI的神隐模式让很多IM和推送开发同行纠结不已：在MIUI深度休眠之后,默认会彻底断开后台应用的socket
但微信、QQ这样的应用，MIUI官方的帖子说了:给这2个应用特殊照顾

情况是这样的： 在MIUI深度休眠之后,默认会彻底断开后台应用的socket,关于微信,和QQ,miui官方的帖子说了,给这2个应用特殊照顾。

问题怎么解决：
咱们自己的app应用就没有这些特殊待遇了,所以就必须需要用户自己来手动设置后台app在深度休眠之后依然要使用网络连接。
位置就在: 设置->其他高级设置->电量和性能 ->"神隐模式"。
没事就是这个神隐模式,默认就是开启的,不注意根本不知道MIUI加了这个坑爹的功能,只要把这个神隐模式关闭之后,推送心跳、IM心跳这些就可以正常的工作了。

关于用户手动设置关闭神隐模式的体验问题：
上面也说了，qq和微信这样的大牌是被MIUI特殊照顾的，其它app就没那么好待遇了，只能自已在UI和功能体验上下功夫了：比如像ios一样，推送通知这样的权限申请时给一个提示框，友好一点，引导用户去解决它（对于你的app一说，首次安装运行时如果是运行在MIUI下，就引导用户去解决这个神隐模式问题了）