## MySQL
###Server层
- 连接器 身份认证 权限管理 连接不断 即使修改了权限 此连接不受影响
- 查询缓存 8.0后移除 缓存select语句及结果集 因经常失效
- 分析器 无命中缓存进入 词法分析 提出关键字段 语法分析 检验语句是否正确
- 优化器 内部实现 
- 执行器 检验有权限后调用引擎接口 返回执行结果
- 日志模块 binlog公有 redolog只InnoDB有
###引擎类型：
    版本：5.7.17
    
    +--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
    | Engine             | Support | Comment                                                        | Transactions | XA   | Savepoints |
    +--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
    | InnoDB             | DEFAULT | Supports transactions, row-level locking, and foreign keys     | YES          | YES  | YES        |
    | MRG_MYISAM         | YES     | Collection of identical MyISAM tables                          | NO           | NO   | NO         |
    | MEMORY             | YES     | Hash based, stored in memory, useful for temporary tables      | NO           | NO   | NO         |
    | BLACKHOLE          | YES     | /dev/null storage engine (anything you write to it disappears) | NO           | NO   | NO         |
    | MyISAM             | YES     | MyISAM storage engine                                          | NO           | NO   | NO         |
    | CSV                | YES     | CSV storage engine                                             | NO           | NO   | NO         |
    | ARCHIVE            | YES     | Archive storage engine                                         | NO           | NO   | NO         |
    | PERFORMANCE_SCHEMA | YES     | Performance Schema                                             | NO           | NO   | NO         |
    | FEDERATED          | NO      | Federated MySQL storage engine                                 | NULL         | NULL | NULL       |
    +--------------------+---------+----------------------------------------------------------------+--------------+------+------------+
    
####MyISAM和InnoDB区别 
  
  MyISAM:
        
        支持全文索引、压缩、空间函数等，
        但MyISAM不支持事务和行级锁，而且最大的缺陷就是崩溃后无法安全恢复
  
  InnoDB:
  
        支持事务 外键 行级锁 MVCC 支持真正的在线热备份
  
###索引类型：   
    
    Hash索引：
        InnoDB当索引使用频繁时在B+Tree上再建哈希索引
    B+Tree索引：
    Fractal Tree索引：
    全文索引：
        MyISAM支持全文索引 用以查找文本关键字 而不是直接比较是否相等
        MATCH AGAINST 不是WHERE InnoDB 5.6.4后支持全文索引
    空间数据索引：
        MyISAM支持空间数据索引（R-Tree） 地理数据存储


 
###多版本并发控制（MVCC）：

    只使用于读提交和可重复读
    InnoDB 存储引擎实现隔离级别的一种具体方式，用于实现提交读和可重复读这两种隔离级别
    版本号
        系统版本号 开启一个事务 就会递增
        事务版本号 事务开始时系统版本号
    隐藏列：    每行记录后有两个隐藏列版本号
        创建版本号 创建时系统版本号
        删除版本号 删除版本未定义或大于当前事务版本号则该快照有效
    Undo日志
        使用的快照存储在Undo日志 通过回滚指针把一个行所有快照连接
 
###事务: 
 事务是逻辑上的一组操作，要么都执行，要么都不执行
 
四大特性： ACID       
        
    原子性（Atomicity）： 事务是最小的执行单位，不允许分割。事务的原子性确保动作要么全部完成，要么完全不起作用；
    一致性（Consistency）： 执行事务前后，数据保持一致，多个事务对同一个数据读取的结果是相同的；
    隔离性（Isolation）： 并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务之间数据库是独立的；
    持久性（Durability）： 一个事务被提交之后。它对数据库中数据的改变是持久的，即使数据库发生故障也不应该对其有任何影响。

事务问题：

    脏读（Dirty read）: 当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。
    丢失修改（Lost to modify）: 指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。 例如：事务1读取某表中的数据A=20，事务2也读取A=20，事务1修改A=A-1，事务2也修改A=A-1，最终结果A=19，事务1的修改被丢失。
    不可重复读（Unrepeatableread）: 指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。
    幻读（Phantom read）: 幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，所以称为幻读。

不可重复读和幻读区别：

    不可重复读的重点是修改比如多次读取一条记录发现其中某些列的值被修改，幻读的重点在于新增或者删除比如多次读取一条记录发现记录增多或减少了
  
事务隔离级别：

    READ-UNCOMMITTED(读取未提交)： 最低的隔离级别，允许读取尚未提交的数据变更，可能会导致脏读、幻读或不可重复读。
    READ-COMMITTED(读取已提交)： 允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生。
    REPEATABLE-READ(可重复读)： 默认隔离级别,对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。
    SERIALIZABLE(可串行化)： 最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读
###锁机制：
  三级封锁协议
     
 - 写与写互斥 防止数据覆盖
 - 读不允许写 防止脏读
 - 读不允许写 防止不可重复读
    
  两段锁协议

 - 加锁与解锁分成两个阶段
 
 意向锁都是表级锁 相互兼容
###数据库优化
限制查询 少用*
读写分离 主库写 从库查
垂直分区 数据表列拆分 拆成多表 对事务要求更复杂
    MySQL分区表 物理上为多文件 逻辑上为一个表 跨分区查询效率低 建议采用物理分表
水平分区 分库 事务逻辑复杂
####数据库字段设计规范
- 字符串转换成数字类型存储 IP地址 inet_aton inet_ntoa 
- 非负数数据（如自增ID）优先无符号整型
- 避免使用TEXT BLOB 大数据 内存临时表不支持 只能磁盘临时表 只能前缀索引 
- 避免使用ENUM 操作复杂
- 尽可能所有列都为非空 索引NULL列需要额外空间 比较计算也要特殊处理
- 存储时间不用字符串 占用更大空间 无法直接比较
- 财务金额使用decimal
####索引设计规范
- 限制每张表上的索引数量,建议单张表索引不超过 5 个
- 禁止给表中的每一列都建立单独的索引
- 每个 Innodb 表必须有个主键
- 频繁的查询优先考虑使用覆盖索引 避免 Innodb 表进行索引的二次查询  随机 IO 变成顺序 IO 
- 尽量避免使用外键约束
- 避免使用子查询，可以把子查询优化为 join 操作
- 避免使用 JOIN 关联太多的表
- 减少同数据库的交互次数
- 对应同一列进行 or 判断时，使用 in 代替 or
- WHERE 从句中禁止对列进行函数转换和计算

**MySQL字符集**
采用类似继承方式 表的默认字符集是数据库的字符集 未指定使用时采用默认

**索引**